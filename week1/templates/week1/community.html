{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
                <meta name="description" content="Match Hat">
                    <meta name="author" content="Find your collaborator, complete your project.">
                        <title>Match Hat - Community Page</title>
                            <!-- Bootstrap core CSS -->
                            <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
                            <!-- Custom fonts for this template -->
                            <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

                            <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/flick/jquery-ui.css">
                            <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/css/tokenfield-typeahead.min.css" rel="stylesheet" type="text/css">
                            <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/css/bootstrap-tokenfield.min.css" rel="stylesheet" type="text/css">
                            <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/css/base/jquery-ui.min.css" rel="stylesheet" type="text/css">

                            <link rel='stylesheet' type='text/css' href="/static/week1/style.css">
    </head>
<body id="page-top">
    <!-- Navigation -->        
    <nav class="navbar communityNav navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand" href="{% url 'week1:community' %}">
                <img src="{% static 'images/MatchHat Logo-01.png'%}" >
        </a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu

            <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <form class="form-inline my-2 my-md-0 searchBarTop navbar-nav mx-auto ">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" name="srch-term" id="srch-term">
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>
            <ul class="navbar-nav mx-auto nav-flex-icons">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'week1:feedback' %}"> <small> Feedback </small> </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{% url 'week1:community' %}">
                        <i class="fa fa-users"></i>
                    </a>
                </li>
                <!--li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="fa fa-user-plus"></i>
                    </a>
                </li-->
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'week1:messages' %}">
                        <i class="fa fa-comment-o"></i>
                    </a>
                </li>
            </ul>
            <ul class="navbar-nav navbar-right">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-user"></i>&nbsp;{{user.first_name}}
                    </a>
                    <div class="dropdown-menu" aria-labelledby="dropdown04">
                        <a class="dropdown-item" href="{% url 'week1:home' %}">My Profile</a>
                        <a class="dropdown-item" href="{% url 'week1:logout' %}" onclick="logoutFunction()">Logout</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>
<!-- content -->
<section class="communityBody">
    <div class="container">
        <div class="column col-sm-12 col-xs-12" id="main">
            <div class="row">
                <!-- main col left -->
                <div class="communityBodyLeft col-sm-5">
                    <div class="panel panel-communityLeft">
                        <div class="panel-heading">
                            <h2>Collaborators</h2>
                        </div>
                        <div class="panel-body clearfix" id="collaborators_needyou">
                            <h3>Collaborators looking for you</h3>
                            <!--div class="well well-sm personEntity">
                                <div class="media">
                                    <a class="thumbnail pull-left" href="#">
                                        <img class="media-object" src="http://www.fillmurray.com/67/67">
                                    </a>
                                    <div class="media-body">
                                        <h4 class="media-heading">Amy Tanaka</h4>
                                        <p class="small">
                                            <a href="#">3 mutual community members</a>
                                        </p>
                                    </div>
                                </div>
                            </div-->
                            <p class="small">
                                <a class="pull-right" href="{% url 'week1:more_collaborators_list' %}">show more</a>
                            </p>
                        </div>
                        <hr>
                        <div class="panel-body clearfix" id="collaborators_youneed">
                            <h3>Suggested collaborators</h3>
                            <!-- div class="well well-sm personEntity">
                                <div class="media">
                                    <a class="thumbnail pull-left" href="#">
                                        <img class="media-object" src="http://placekitten.com/67/67">
                                    </a>
                                    <div class="media-body">
                                        <h4 class="media-heading">Ciara Simons, UX Designer</h4>
                                        <p class="small">
                                            # Note: dont use this at this point
                                            <a href="#">3 mutual community members</a>
                                        </p>
                                    </div>
                                </div>
                            </div-->
                            <p class="small">
                                <a class="pull-right" href="{% url 'week1:more_collaborators_list' %}">show more</a>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- main col right -->
                <div class="communityBodyRight col-sm-7">
                    <div class="paddingCommunityThread">
                        <div class="panel panel-white clearfix">
                            <div class="well">
                                <form class="form-horizontal" role="form">
                                    <h3>Community whiteboard- Connect; Collaborate; Create</h3>
                                    <div class="well well-sm personEntity">
                                        <div class="media">
                                            <a class="thumbnail pull-left" href="#">
                                                <img class="media-object" width="80" src="{{media_url}}userphoto/{{user.uid}}.png" onerror="this.onerror=null;this.src='{% static 'images/profileimage.png' %}';">
                                            </a>
                                            <div class="media-body">
                                                <div class="form-group">
                                                    <textarea class="form-control" id="p" placeholder="Enter your message"></textarea>
                                                    <!-- button class="btn btn-lg btn-outline pull-right" type="button">Post</button-->
                                                    <div class="dropdown">
                                                        <button class="btn btn-lg btn-outline pull-right" type="button" id="about-us" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Post</button>

	                                                    <div class="dropdown-menu" aria-labelledby="about-us">
	                                                        <a href="#" class="dropdown-item" onclick="return publicPost()">Share with the public </a>
                            
                                                            <a href="#" class="dropdown-item" onclick="return privatePost()">Share with your community </a>
	                                                        <!--a class="dropdown-item" href="#">Share with public</a>
	                                                        <a class="dropdown-item" href="#">Share with community</a-->
	                                                    </div>
	                                                </div>

                                                    <!--button onclick="return publicPost()" class="btn btn-lg btn-outline pull-right">Post</button-->
                                                    
                                                    <label>Skill tag (up to 5)</label>
                                                    <!-- ul id="myTags"></ul-->
                                                    <input type="text" class="form-control" id="token-skillfield" name="skilltags" />

    
                                                    <ul class="list-inline communityActionListBig pull-left">
                                                        <!-- li class="list-inline-item">
                                                            <a href="#">
                                                                <i class="fa fa-camera"></i>
                                                            </a>
                                                        </li>
                                                        <li class="list-inline-item">
                                                            <a href="#">
                                                                <i class="fa fa-smile-o"></i>
                                                            </a>
                                                        </li>
                                                        <li class="list-inline-item">
                                                            <a href="#">
                                                                <i class="fa fa-star"></i>
                                                            </a>
                                                        </li>
                                                        <li class="list-inline-item">
                                                            <a href="#">
                                                                <i class="fa fa-picture-o"></i>
                                                            </a>
                                                        </li -->
                                                        <li class="list-inline-item">
                                                            <label for="imageupload" class="custom-file-upload">
                                                                <i class="fa fa-paperclip"></i>
                                                                <input id="imageupload" type="file" />
                                                            </label>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="panel panel-white clearfix" id="communityThread">

                        <!--div class="panel panel-white clearfix">
                            <div class="panel-body">
                                <div class="well well-sm personEntity">
                                    <div class="media">
                                        <a class="thumbnail pull-left" href="#">
                                            <img class="media-object" src=" http://placebeard.it/67x67">
                                        </a>
                                        <div class="media-body">
                                            <h4 class="media-heading">Gabriel Davidson - 
                                                <em>Photographer</em>
                                            </h4>
                                            <p>
                                                <strong>Does anyone know a good <a href="#">hair stylist</a>  who is available next Friday for a fashion show?
                                                </strong>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <ul class="list-inline matchHatActionList">
                                    <li class="list-inline-item">
                                        <span>128</span>
                                        <a href="#">
                                            <i class="faMatchHatbtn fa-hat"></i>Tip-hat
                                        </a>
                                    </li>
                                    <li class="list-inline-item">
                                        <span>128k</span>
                                        <a href="#">
                                            <i class="faMatchHatbtn fa-collaborate"></i>Collaborate
                                        </a>
                                    </li>
                                    <li class="list-inline-item">
                                        <span>128</span>
                                        <a href="#">
                                            <i class="faMatchHatbtn fa-sharez"></i>Share
                                        </a>
                                   </li>
                                </ul>
                                <div class="communityReply">
                                    <a class="thumbnail pull-left" href="#">
                                       <img class="media-object" src=" http://placebeard.it/57x57">
                                    </a>
                                   <div class="replyBody">
                                       <p class="replyUsername"><a href="#"><strong>Naotomo Umewaka</strong></a></p>
                                       <p>        <strong>I can introduce you to a friend. I will send you a message
                                                </strong>
                                        </p>
                                   </div>
                                </div>

                                <form class="form-horizontal communityReplyForm" role="form">
                                    <div class="form-group">
                                        <textarea class="form-control" placeholder="Enter your message here"></textarea>
                                        <button class="btn btn-lg btn-outline pull-right" type="button">Post</button>
                                        <ul class="list-inline communityActionListSmall">
                                            <li class="list-inline-item">
                                                <a href="">
                                                    <i class="fa fa-camera"></i>
                                                </a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="">
                                                    <i class="fa fa-smile-o"></i>
                                                </a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="">
                                                    <i class="fa fa-star"></i>
                                                </a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="">
                                                    <i class="fa fa-picture-o"></i>
                                                </a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="">
                                                    <i class="fa fa-paperclip"></i>
                                                </a>
                                           </li>
                                        </ul>
                                    </div>
                                </form>
                            </div>
                        </div-->
                        </div>
                    </div>
                    <!-- paddingCommunityThread ende -->
                </div>
            </div>
        </div>
    </div>
</section>

<div class="popup-box chat-popup" id="qnimate">
    <div class="popup-head">
        <div class="popup-head-left pull-left">

        </div>

        <div class="popup-head-right pull-right">
            <button data-widget="remove" id="removeClass" class="chat-header-button pull-right" type="button" onclick="closeChat()">x</button>
        </div>
    </div>

    <div class="popup-messages">
        <div class="direct-chat-messages" id="chat_room">

        </div>

    </div>
    <div class="popup-messages-footer">
        <textarea id="status_message" placeholder="Type a message..." rows="20" cols="40" name="message"></textarea>
        <div class="btn-footer">
          <button class="btn btn-primary btn-lg pull-right" onclick="sendMessage()">Send </button>
        </div>
    </div>
</div>
<!-- content ende -->
<!-- Footer -->
<footer class="text-center">
    <div class="footer-above">
        <div class="container">
            <div class="row">
                <div class="footer-col col-md-3">
                    <h3>Location</h3>
                    <ul class="list-unstyled">
                        <li>
                            <a href="@">About</a>
                        </li>
                        <li>
                            <a href="@">Terms</a>
                        </li>
                        <li>
                            <a href="@">Privacy</a>
                        </li>
                        <li>
                            <a href="@">Careers</a>
                        </li>
                    </ul>
                </div>
                <div class="footer-col col-md-3">
                    <h3>Follow Us</h3>
                    <ul class="list-inline">
                        <li class="list-inline-item">
                            <a class="btn-social btn-outline" href="#">
                                <i class="fa fa-fw fa-facebook"></i>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a class="btn-social btn-outline" href="#">
                                <i class="fa fa-fw fa-google-plus"></i>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a class="btn-social btn-outline" href="#">
                                <i class="fa fa-fw fa-twitter"></i>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a class="btn-social btn-outline" href="#">
                                <i class="fa fa-fw fa-linkedin"></i>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a class="btn-social btn-outline" href="#">
                                <i class="fa fa-fw fa-dribbble"></i>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="footer-col col-md-3">
                    <h3>Feedback</h3>
                    <a href="@">Feedback</a>
                </div>
                <div class="footer-col col-md-3">
                    <h3>Contact</h3>
                    <a href="@">Feedback</a>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-below">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                Copyright &copy; Match Hat 2017
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
<div class="scroll-top d-lg-none">
    <a class="btn btn-primary js-scroll-trigger" href="#page-top">
        <i class="fa fa-chevron-up"></i>
   </a>
</div>
<!--script src="http://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script-->

<!-- Bootstrap core JavaScript -->
<script src="https://code.jquery.com/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.11.1"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/bootstrap-tokenfield.min.js"></script>
<!-- Contact Form JavaScript -->
<!--<script src="js/jqBootstrapValidation.js"></script><script src="js/contact_me.js"></script>-->
<!-- Custom scripts for this template -->
<!-- Socket -->
<script src="{{nodejs_url}}/socket.io/socket.io.js"></script>
<!--script src="https://cdn.socket.io/socket.io-1.2.0.js"></script-->
<script src="{% static 'js/tag_skills.js' %}"></script>
<script type="text/javascript" src="{% static 'js/basic.js' %}"></script>
<script>
    (function($) {
        "use strict"; // Start of use strict
        // Smooth scrolling using jQuery easing
        $('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function() {
            if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                if (target.length) {
                    $('html, body').animate({
                        scrollTop: (target.offset().top - 48)
                    }, 1000, "easeInOutExpo");
                    return false;
                }
            }
        });
        // Closes responsive menu when a scroll trigger link is clicked
        $('.js-scroll-trigger').click(function() {
            $('.navbar-collapse').collapse('hide');
        });
        // Activate scrollspy to add active class to navbar items on scroll
        $('body').scrollspy({
            target: '#mainNav',
            offset: 54
        });
        // Collapse the navbar when page is scrolled
        $(window).scroll(function() {
            if ($("#mainNav").offset().top > 100) {
                $("#mainNav").addClass("navbar-shrink");
            } else {
                $("#mainNav").removeClass("navbar-shrink");
            }
        });
        // Floating label headings for the contact form
        $(function() {
            $("body").on("input propertychange", ".floating-label-form-group", function(e) {
                $(this).toggleClass("floating-label-form-group-with-value", !!$(e.target).val());
            }).on("focus", ".floating-label-form-group", function() {
                $(this).addClass("floating-label-form-group-with-focus");
            }).on("blur", ".floating-label-form-group", function() {
                $(this).removeClass("floating-label-form-group-with-focus");
            });
        });
    })(jQuery); // End of use strict

    /* Use this agagin for tag function
    $(document).ready(function() {
        $("#myTags").tagit();
    });
    */

    socket.emit('join message', {uid:"{{user.uid}}", firstname:"{{user.first_name}}", lastname:"{{user.last_name}}"});
    socket.emit('join community', {uid:"{{user.uid}}", uname:"{{user.first_name}}"});

    var users = [{% for u in users %} "{{ u }}" ,{% endfor %}];
    var names = [{% for u in username %} ["{{ u.0 }}", "{{u.1}}"],{% endfor %}];

    function myDropDownPostFunction() {
        document.getElementById("myPostDropdown").classList.toggle("show");
        return false;
    }

    function submitComment(uid, c_id){
        var post_val = $('#c_'+c_id).val();
                    
        if (post_val.length != 0){
            socket.emit('community comment', {msg:post_val, user:"{{user.uid}}", c_id:c_id});
        }
        $('#c_'+c_id).val('');
        return false;
    }

    function publicPost(){
        var skillls = [];
        var sk = $('#token-skillfield').val();
        if (sk){
        	skillls = sk.split(",");
        }

        /* Use this again once jquery issue is fixed
        for (var i = 0; i < lis.length; i++){
            var t = lis[i].childNodes[0].textContent;
            if ( t!= "" ){
                skillls.push(t.charAt(0).toUpperCase() + t.slice(1)); 
            }
        }
        */

        var files = document.getElementById('imageupload').files;
        var file = files[0];

        var data = {};
        if (file){
            data = {'file':file, 'fileName':file.name, 'type':file.type};
        }

        if ($('#p').val().length != 0){
              socket.emit('community post', {msg:$('#p').val(), data:data, uid:"{{user.uid}}", skillls:skillls}, function(data){
                  //$('#communityPost').append($('<li><span class="error"><br>'+data.nick+':'+data.msg+'</span><br/>'));
              });
              $('#p').val('');
            $('#imageupload').val('');
        }
        $('#token-skillfield').val('');
        return false;
    }

    function privatePost(){
    	var skillls = [];
        var sk = $('#token-skillfield').val();
        if (sk){
        	skillls = sk.split(",");
        }
        /*
        var skillls = [];
        var lis = document.getElementById("myTags").getElementsByTagName("li");

        for (var i = 0; i < lis.length; i++){
            var t = lis[i].childNodes[0].textContent;
            if ( t!= "" ){
                skillls.push(t.charAt(0).toUpperCase() + t.slice(1)); 
            }
        }
        */

        var files = document.getElementById('imageupload').files;
        var file = files[0];

        var data = {};
        if (file){
            data = {'file':file, 'fileName':file.name, 'type':file.type};
        }

        if ($('#p').val().length != 0){
            socket.emit('private post', {msg:$('#p').val(), data:data, uid:"{{user.uid}}", skillls:skillls}, function(data){
            });
            $('#p').val('');
            $('#imageupload').val('');
        }
        $('#token-skillfield').val('');
        return false;
    }

    function editPost(c_id){
        var modal = document.getElementById('editModal_'+c_id);  
        modal.style.display = "block";
    }

    function deletePost(c_id){
        socket.emit('delete community post', c_id);
        document.getElementById("media_"+c_id).innerHTML = '';
    }

    function submitEdit(c_id){
        var post_val = $('#post_text_'+c_id).val();
                    
        if (post_val.length != 0){
            console.log('if:'+post_val);
            socket.emit('update postContent', {msg:post_val, c_id:c_id, uid:"{{user.uid}}" });
            document.getElementById("media-content_"+c_id).innerHTML = '<strong>' + post_val + '</strong>';
            closeEdit(c_id);
        }
        $('#status_message').val('');
        return false;
    }

    function closeEdit(c_id){
        var span = document.getElementById('editClose_'+c_id);
        var modal = document.getElementById('editModal_'+c_id);  
        modal.style.display = "none";
    }

    function createNormalBody(uid, cid, data, yy, mm, dd, content_id = null){
        if ( content_id == null ){
            content_id = cid;
        }
        var imageText = '';
        if (data['image'] && data['image']['data']){
            var bytes = new Uint8Array(data['image']['data']);
            var enc = encode(bytes);
            var ctype = data['image']['contentType'];
            imageText = '<embed id="ItemPreview_'+content_id+'" src="{{community_post_url}}'+content_id+'.png" class="postImage" width=250/></embed>';
            //imageText = '<embed id="ItemPreview_'+content_id+'" src="data:'+ctype+';base64,'+enc+'" class="postImage" /></embed>';
        }
        var content = data['content'];
        var first_name = data['user']['first_name'];
        var last_name = data['user']['last_name'];
        var url_link = "{% url 'week1:get_profile' user.uid %}".replace("{{user.uid}}", uid);
        //<ul class="media-date text-uppercase reviews list-inline"><li class="dd">${dd}</li><li class="mm">${mm}</li><li class="aaaa">${yy}</li></ul>
        var body = `<h3 class="media-heading"><a href=${url_link} display:block>${first_name} ${last_name} </a></h3>
                    <h6> ${dd} ${mm} ${yy} </h6>
                    <p id="media-content_${cid}">
                        <strong>
                            ${content}
                        </strong>
                    </p>
                    ${imageText}
                   `;
        return body;

    }

    function createNewPostBody(uid, cid, data, yy, mm, dd, content_id = null){
        if ( content_id == null ){
            content_id = cid;
        }
        var imageText = '';
        if (data['image'] && data['image']['data']){
            //var bytes = new Uint8Array(data['image']['data']);
            //var enc = encode(bytes);
            //var ctype = data['image']['contentType'];
            //imageText = '<embed id="ItemPreview_'+content_id+'" src="data:'+ctype+';base64,'+enc+'" class="postImage" /></embed>';
            imageText = '<embed id="ItemPreview_'+content_id+'" src="{{community_post_url}}'+content_id+'.png" class="postImage" width=250/></embed>';
            console.log("new image");
        }
        var content = data.msg;
        var first_name = data.first_name;
        var last_name = data.last_name;
        var url_link = "{% url 'week1:get_profile' user.uid %}".replace("{{user.uid}}", uid);
        //<ul class="media-date text-uppercase reviews list-inline"><li class="dd">${dd}</li><li class="mm">${mm}</li><li class="aaaa">${yy}</li></ul>
        var body = ` 
                    <h3 class="media-heading"><a href=${url_link} display:block>${first_name} ${last_name} </a></h3>
                    </h3>
                    <h6> ${dd} ${mm} ${yy} </h6>
                    <p>
                        <strong>
                            ${content}
                        </strong>
                    </p>
                    ${imageText}
                   `;
        return body;

    }

    function createPortfolioBody(uid, cid, portfolio, data, yy, mm, dd){
        var imageText = '';
        if (portfolio.image){
            imageText = '<object id="ItemPreview_'+cid+'" data="{{media_url}}'+portfolio.image+'" width="350px" /></object>';
        }
        
        var first_name = data['user']['first_name'];
        var last_name = data['user']['last_name'];
        var body = `<h3 class="media-heading">${first_name} ${last_name} 
                    </h3>
                    <h6> ${dd} ${mm} ${yy} </h6>
                    <p>
                        <strong>
                        Title: ${portfolio.title}
                        <br>
                        Description: ${portfolio.description}
                        </strong>
                    </p>
                    ${imageText}
                   `;
        return body;
    }

    function createActionList(uid, cid, countLikes, countShares, isLike, isShare, isHatsoff){
        if (isLike) {
           var like = 'UnLike';
           var like_icon = 'faMatchHatbtn fa-hat active';
           var like_function = `unlikeCommunityFunction(\'${uid}\', \'${cid}\')`;
        } else{
           var like = 'Like';
           var like_icon = 'faMatchHatbtn fa-hat inactive';
           var like_function = `likeCommunityFunction(\'${uid}\', \'${cid}\')`;
        }

        if (isShare) {
           var share = 'UnShare';
           var share_icon = 'faMatchHatbtn fa-sharez active';
           var share_function = `unshareCommunityFunction(\'${uid}\', \'${cid}\')`;
        } else{
           var share = 'Share';
           var share_icon = 'faMatchHatbtn fa-sharez inactive';
           var share_function = `shareCommunityFunction(\'${uid}\', \'${cid}\')`;
        }

        if (isHatsoff){
           var hatsoff = 'UnHatsoff';
           var hatsoff_icon = 'faMatchHatbtn fa-hat active';
           var hatsoff_function = `unhatsoffCommunityFunction(\'${uid}\', \'${cid}\')`;
        } else{
           var hatsoff = 'Hatsoff';
           var hatsoff_icon = 'faMatchHatbtn fa-hat inactive';
           var hatsoff_function = `hatsoffCommunityFunction(\'${uid}\', \'${cid}\')`;
        }

        var actionList = `
          <ul class="list-inline matchHatActionList">
              <li class="list-inline-item">
                  <span onclick="getLikeusers(${cid})" id="like_count_${cid}">${countLikes}</span>
                  <a href="#" onclick="${like_function}; return false;" id="like_click_${cid}">
                      <i class="${like_icon}" id="like_icon_${cid}"></i>${like}
                  </a>
              </li>
              <li class="list-inline-item">
                  <span id="share_count_${cid}">${countShares}</span>
                  <a href="#" onclick="${share_function}; return false;" id="share_click_${cid}">
                      <i class="${share_icon}" id="share_icon_${cid}"></i>${share}
                  </a>
              </li>
              <li class="list-inline-item">
                  <a href="#" onclick="${hatsoff_function}; return false;" id="hatsoff_click_${cid}">
                      <i class="${hatsoff_icon}" id="hatsoff_icon_${cid}"></i>${hatsoff}
                  </a>
              </li>
              <li class="list-inline-item">
                  <a href="#" onclick="collaborateFunction(\'${uid}\', \'${cid}\'); return false;">
                      <i class="faMatchHatbtn fa-collaborate"></i>Collaborate
                  </a>
              </li>
          </ul>
        `;
        return actionList;
    }

    function createEditDelete(uid, cid, msg){
    	var user_id = "{{user.uid}}";
    	if ( uid != user_id ){
    	    return '';	
    	}
        var editDelete  = `
                              <div class="dropdown">
                                  <button class="btn btn-primary dropdown-toggle icon2 pull-right" type="button" id="editPosht003" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      <i class="fa fa-pencil"></i>
                                  </button>
                                  <div class="dropdown-menu" aria-labelledby="about-us">
                                      <a class="dropdown-item" onclick="return editPost(\'${cid}\')">Edit post</a>
                                      <a class="dropdown-item" onclick="return deletePost(\'${cid}\')">Delete post</a>
                                  </div>
                              </div>
                              <div id="editModal_${cid}" class="modal_community">
                                  <div class="modal-content">
                                      <span class="close" id="editClose_${cid}" onclick="closeEdit(\'${cid}\')">&times;</span>
                                      <div id="edit_post_${cid}">
                                          <textarea id="post_text_${cid}" rows="20" cols="40" name="message"> ${msg} </textarea>
                                      </div>
                                      <button class="btn btn-primary" onclick="return submitEdit(\'${cid}\')" align="right">Edit</button>
                                  </div>
                              </div>
                           `;
        return editDelete;
    }

    function createReplyList(uid, cid, replys){
        if (replys){
            var replyList = `<div id="commentHistory_${cid}">
                            `;
            for(var i=0; i < replys.length; i++){
                if (replys[i]['user']['uid']){
                    var r_id = i;
                    var ruid = replys[i]['user']['uid'];
                    var deleteOrEdit_cmt = (ruid == uid) ? '<div class="dropdown"><img src="{% static 'images/threedots_32x32.png' %}" onclick="myDropDownDelEditFunction(\''+cid+'_'+r_id+'\')" class="dropDelEditIcon"><div id="myDelEditDropdown_'+cid+'_'+r_id+'" class="dropdown-DelEditContent"><a href="#" onclick="return deleteComment(\''+cid+'\', \''+r_id+'\')">Delete</a><a href="#" onclick="return editComment(\''+cid+'\', \''+r_id+'\')">Edit</a></div></div>' : '';

                    var edit_cmt = (ruid == uid) ? '<div id="editModal_'+cid+'_'+r_id+'" class="modal_community"><div class="modal-content"><span class="close" id="editClose_'+cid+'_'+r_id+'" onclick="closeEdit(\''+cid+'_'+r_id+'\')">&times;</span><div id="edit_post_'+cid+'_'+r_id+'"><textarea id="post_text_'+cid+'_'+r_id+'" rows="20" cols="40" name="message">'+replys[i]['content']+'</textarea></div><button class="btn btn-primary" onclick="return submitcommentEdit(\''+cid+'\', \''+r_id+'\')" align="right">Edit</button></div></div>' : '';

                    deleteOrEdit_cmt = '';
                    edit_cmt = '';
                    var m  = users.indexOf(ruid);
                    var url_link = "{% url 'week1:get_profile' user.id %}".replace("{{user.id}}", ruid);
                    var first_name = replys[i]['user']['first_name'];
                    var last_name = replys[i]['user']['last_name'];
                    var body = replys[i]['content'];
                    var replyBodies = `<div class="communityReply" class="community_comment_${r_id}">
                                           <a class="thumbnail pull-left" href="#">
                                                <img class="media-object" src="{{media_url}}userphoto/${ruid}.png" onerror="this.onerror=null;this.src='{% static 'images/profileimage.png' %}';">
                                           </a>
                                           <p class="replyUsername"><a href="${url_link}"><strong>${first_name} ${last_name}</strong></a>${deleteOrEdit_cmt}</p>
                                           <p>  <strong> ${body}
                                                </strong>
                                           ${edit_cmt}
                                           </p>
                                       </div>`;                        
                    replyList += replyBodies;
                }
            }
            replyList += `</div>`;
            return replyList;
        } else{
            return '';
        }
    }

    function create_thread(uid, cid, body, actionList, replyList, editDelete, privateText = ''){
        var thread = `
           <div class="panel panel-white clearfix">
              ${privateText}
              <div class="panel-body">
                  <div class="well well-sm personEntity" id="media_${cid}"">
                      <div class="media">
                          <a class="thumbnail pull-left" href="#">
                              <img class="media-object" width="80" src="{{media_url}}userphoto/${uid}.png" onerror="this.onerror=null;this.src='{% static 'images/profileimage.png' %}';">
                          </a>
                          <div class="media-body">
                              ${editDelete} 
                              ${body}
                          </div>
                      </div>
                  </div>
                  <hr />

                  ${actionList}

                  ${replyList}

                  <form class="form-horizontal communityReplyForm" role="form">
                      <div class="form-group">
                          <textarea class="form-control" placeholder="Enter your comment here" id="c_${cid}" autocomplete="off" name="message"></textarea>
                          <button class="btn btn-lg btn-outline pull-right" type="button" onclick="return submitComment(\'${uid}\', \'${cid}\')">Post</button>
                          <ul class="list-inline communityActionListSmall">
                              <li class="list-inline-item">
                                  <a href="">
                                      <i class="fa fa-camera"></i>
                                  </a>
                              </li>
                              <li class="list-inline-item">
                                  <a href="">
                                      <i class="fa fa-smile-o"></i>
                                  </a>
                              </li>
                              <li class="list-inline-item">
                                  <a href="">
                                      <i class="fa fa-star"></i>
                                  </a>
                              </li>
                              <li class="list-inline-item">
                                  <a href="">
                                      <i class="fa fa-picture-o"></i>
                                  </a>
                              </li>
                              <li class="list-inline-item">
                                  <a href="">
                                      <i class="fa fa-paperclip"></i>
                                  </a>
                             </li>
                          </ul>
                      </div>
                  </form>
              </div>
           </div>
        `;    
        return thread;
    }

    socket.on('new private post', function(data){
        var uid = data.uid;
        var c_id = data.community_id;
        var today = new Date();
        var yy = today.getFullYear();
        var mm = months[today.getMonth()];
        var dd = today.getDate();
        var actionList = createActionList(uid, c_id, 0, 0, false, false, false);
        var replyList = createReplyList(uid, c_id, null)
        var body = createNewPostBody(uid, c_id, data, yy, mm, dd)
        var editDelete = createEditDelete(uid, c_id, data.msg)
        var thread = create_thread(uid, c_id, body, actionList, replyList, editDelete, 'Private post')

        $('#communityThread').prepend($(thread));
    });

    socket.on('new community post', function(data){
        var uid = data.uid;
        var c_id = data.community_id;
        var today = new Date();
        var yy = today.getFullYear();
        var mm = months[today.getMonth()];
        var dd = today.getDate();
        var actionList = createActionList(uid, c_id, 0, 0, false, false, false);
        var replyList = createReplyList(uid, c_id, null)
        var body = createNewPostBody(uid, c_id, data, yy, mm, dd)
        var editDelete = createEditDelete(uid, c_id, data.msg)
        var thread = create_thread(uid, c_id, body, actionList, replyList, editDelete)

        $('#communityThread').prepend($(thread));
    });

    socket.on('new community comment', function(data){
        var uid = data.uid;
        var c_id = data.community_id;
        var n  = users.indexOf(uid);
        var url_link = "{% url 'week1:get_profile' user.id %}".replace("{{user.uid}}", uid);
        var first_name = data.first_name;
        var last_name = data.last_name;
        var msg = data.msg;
        var body = `
                    <div class="replyBody" class="community_comment">
                        <p class="replyUsername"><a href="${url_link}"><strong>${first_name} ${last_name}</strong></a></p>
                        <p>  <strong> ${msg}
                            </strong>
                        </p>
                    </div>`;

        $('#commentHistory_'+c_id).append($(body));
    });

    socket.on('update community post', function(data){
        var docs = (typeof data["docs"] == "string") ? JSON.parse(data["docs"]) : data["docs"];
        var sharedocs = (typeof data["sharedocs"] == "string") ? JSON.parse(data["sharedocs"]) : data["sharedocs"];
        var likedocs = (typeof data["likedocs"] == "string") ? JSON.parse(data["likedocs"]) : data["likedocs"];
        var hatsoffdocs = (typeof data["hatsoffdocs"] == "string") ? JSON.parse(data["hatsoffdocs"]) : data["hatsoffdocs"];

        var sharels = [];
        var likels = [];
        var hatsoffls = [];
        var friends = data.friends;

        for (var i=0; i < sharedocs.length; i++){
            sharels.push(sharedocs[i]['content_id']);
        }
        for (var i=0; i < likedocs.length; i++){
            likels.push(likedocs[i]['content_id']);
        }
        for (var i=0; i < hatsoffdocs.length; i++){
            hatsoffls.push(hatsoffdocs[i]['content_id']);
        }

        for(var i=0; i < docs.length; i++){
            if (docs[i]['user'] && docs[i]['user']['uid']) {
                var uid = docs[i]['user']['uid'];
                var c_id = docs[i]['_id'];
                var n  = users.indexOf(uid.toString());
                var created = docs[i]['created'];
                var colonIndex = created.indexOf(":");
                var date = created.substring(0, colonIndex-3);
                var datels = date.split('-');
                var mm = months[parseInt(datels[1])-1];
                var dd = datels[2];
                var yy = datels[0];
                var shared_info = '';
                var count_likes = 0;
                var count_shares = 0;

                var privateShow = 0;

                if (docs[i]['communityFlag']){
                    if (docs[i]['communityFlag'] == 1){
                        if (friends.indexOf(uid) != -1 || uid == "{{user.uid}}"){
                            privateShow = 1;
                        } else{
                            privateShow = -1;
                        }
                    }
                }

                if (privateShow != -1){
                    if (docs[i]['likes']){
                        count_likes = docs[i]['likes']; 
                    }

                    if (docs[i]['shares']){
                      count_shares = docs[i]['shares']; 
                    }

                    var privateText = '';
                    if (privateShow == 1){
                        privateText = 'Private post';
                    }

                    if(docs[i]['sharedBy']){
                       var s_user = docs[i]['sharedBy']; 
                       if(s_user == "{{user.uid}}"){
                           shared_info = '<li class="media">You shared</li>';

                        }else{
                           var sn  = users.indexOf(s_user.toString());
                           console.log("sn", sn)
                           console.log("users", users)
                           shared_info = '<li class="media">'+names[sn][0]+'&nbsp'+names[sn][1]+' shared</li>';
                        }
                    }

                    if(docs[i]['content_id']){
                        c_id = docs[i]['content_id']; 
                    }

                    var tag = (docs[i]['tag']) ? docs[i]['tag'] : 0;
                    //var url_mask = "{% url 'week1:add_folder' user.uid %}".replace("{{user.uid}}", uid);
                    var url_link = "{% url 'week1:get_profile' user.uid %}".replace("{{user.uid}}", uid);
                    var post_link = "{% url 'week1:community_post'%}?c_id="+c_id+"&tag="+tag+"&u="+uid;
                    var profile_link = "{% static 'images/profileimage.png' %}";
                    var thanks = '';
                    var follow = '<div class="popupFollow" onclick="followFunction('+uid+')">Follow &nbsp</br><span class="popuptextFollow" id="followPop">Followed this user!</br></span></div>';

                    if (likels.indexOf(c_id) != -1){
                        isLike = true;
                    } else{
                        isLike = false;
                    }

                    if (sharels.indexOf(c_id) != -1){
                        isShare = true;
                    } else{
                        isShare = false;
                    }

                    if (hatsoffls.indexOf(c_id) != -1){
                        isHatsoff = true;
                    } else{
                        isHatsoff = false;
                    }
                    
                    var actionList = createActionList(uid, c_id, count_likes, count_shares, isLike, isShare, isHatsoff);
                    var replyList = createReplyList(uid, c_id, docs[i]['replys'])

                    var listlikes = '<div id="likeModal_'+c_id+'" class="modal_community"><div class="modal-content"><span class="close" id="likeClose_'+c_id+'" onclick="closeLikeList(\''+c_id+'\')">&times;</span><h3>Users who liked</h3><div id="like_users_'+c_id+'"></div></div></div>';

                    var listshares = '<div id="shareModal_'+c_id+'" class="modal_community"><div class="modal-content"><span class="close" id="shareClose_'+c_id+'" onclick="closeShareList(\''+c_id+'\')">&times;</span><h3>Users who shared</h3><div id="share_users_'+c_id+'"></div></div></div>';

                    var dells = '';
                    var editls = '';
                    var edit = '';
                      
                    var deleteOrEdit = '';

                    if (docs[i]['portfolio']){
                        var portfolio = docs[i]['portfolio'];
                        var body = createPortfolioBody(uid, c_id, portfolio, docs[i], yy, mm, dd)
                        var thread = create_thread(uid, c_id, body, actionList, replyList, privateText)

                        $('#communityThread').append($(thread));
                        continue;                            
                    }

                    if (docs[i]['upcoming']){
                        var upcoming = docs[i]['upcoming'];
                        var body = createPortfolioBody(uid, c_id, upcoming, docs[i], yy, mm, dd)
                        var thread = create_thread(uid, c_id, body, actionList, replyList, privateText)
                        $('#communityThread').append($(thread));

                        continue;                            
                    }

                    if (docs[i]['sharedBy']){
                        var content_id = docs[i]['content_id'];
                        for(var j=0; j < docs.length; j++){
                            if ( docs[j]['_id'] == content_id ){
                                break; 
                            }
                        }
                        uid = docs[j]['user']['uid'];
                        tag = (docs[j]['tag']) ? docs[j]['tag'] : 0;
                        //url_mask = "{% url 'week1:add_folder' user.uid %}".replace("{{user.uid}}", uid);
                        url_link = "{% url 'week1:get_profile' user.uid %}".replace("{{user.uid}}", uid);
                        post_link = "{% url 'week1:community_post'%}?c_id="+content_id+"&tag="+tag+"&u="+uid;
                        created = docs[j]['created'];
                        colonIndex = created.indexOf(":");
                        date = created.substring(0, colonIndex-3);
                        datels = date.split('-');
                        mm = months[parseInt(datels[1])-1];
                        dd = datels[2];
                        yy = datels[0];

                        var imageText = '';
                        if (docs[j]['image'] && docs[j]['image']['data']){
                            var bytes = new Uint8Array(docs[j]['image']['data']);
                            var enc = encode(bytes);
                            var ctype = docs[j]['image']['contentType'];
                            imageText = '<embed id="ItemPreview_'+content_id+'" src="data:'+ctype+';base64,'+enc+'" class="postImage" width=250/></embed>';
                        }

                        var skillls = '';
                        if (docs[j]['skillls']){
                            if(docs[j]['skillls'].length != 0){
                                var ls = docs[j]['skillls'];
                                skillls += "<div> Tags: ";
                                for (var k = 0; k < docs[j]['skillls'].length; k++){
                                    var skill_link = "{% url 'week1:talent_list' 12345 %}".replace(/12345/, docs[j]['skillls'][k]);
                                    skillls += "<a href='"+skill_link+"'>"+docs[j]['skillls'][k]+"</a>" + "&nbsp";
                                }  
                                skillls += "</div><br>";
                            }
                        }

                        if (docs[j]['likes']){
                            count_likes = docs[j]['likes']; 
                        }

                        if (docs[j]['shares']){
                            count_shares = docs[j]['shares']; 
                        }

                        if (likels.indexOf(content_id) != -1){
                            isLike = true;
                        }else{
                            isLike = false;
                        }

                        share = '';
                        if (sharels.indexOf(content_id) != -1){
                            isShare = true;
                        }else{
                            isShare = false;
                        }

                        hatsoff = '';
                        if (hatsoffls.indexOf(content_id) != -1){
                            isHatsoff = true;
                        }else{
                            isHatsoff = false;
                        }

                        var actionList = createActionList(uid, c_id, count_likes, count_shares, isLike, isShare, isHatsoff);
                        var replyList = createReplyList(uid, c_id, docs[i]['replys'])
                        var body = createNormalBody(uid, c_id, docs[j], yy, mm, dd, content_id)
                        var thread = create_thread(uid, c_id, body, actionList, replyList, '', privateText)

                        $('#communityThread').append($(thread));
                        continue;
                    }
                      
                    if (docs[i]['skillls']){
                        if(docs[i]['skillls'].length != 0){
                            var ls = docs[i]['skillls'];
                            skillls += "<div> Tags: ";
                            for (var j = 0; j < docs[i]['skillls'].length; j++){
                                var skill_link = "{% url 'week1:talent_list' 12345 %}".replace(/12345/, docs[i]['skillls'][j]);
                                skillls += "<a href='"+skill_link+"'>"+docs[i]['skillls'][j]+"</a>" + "&nbsp";
                            } 
                            skillls += "</div><br>";
                        }
                    }

                    var actionList = createActionList(uid, c_id, count_likes, count_shares, isLike, isShare, isHatsoff);
                    var replyList = createReplyList(uid, c_id, docs[i]['replys'])
                    var body = createNormalBody(uid, c_id, docs[i], yy, mm, dd)
                    var editDelete = createEditDelete(uid, c_id, docs[i]['content'])
                    var thread = create_thread(uid, c_id, body, actionList, replyList, editDelete, privateText)

                    $('#communityThread').append($(thread));

                }
            }
        }
    });

    socket.on('three collaborators you need', function(docs){
      if (docs){
    	for(var i=0; i < docs.length; i++){
            var uid = docs[i].uid;
            var first_name = docs[i].first_name;
            var last_name = docs[i].last_name;
            var profession = docs[i].profession1;
            var url_link = "{% url 'week1:get_profile' user.uid %}".replace("{{user.uid}}", uid);
            var n  = users.indexOf(uid);

            var body = `
                        <div class="well well-sm personEntity">
                            <div class="media">
                                <a class="thumbnail pull-left" href="#">
				    <img class="media-object" width="100" src="{{media_url}}userphoto/${uid}.png" onerror="this.onerror=null;this.src='{% static 'images/profileimage.png' %}';">
                                </a>
                                <div class="media-body">
                                    <h4 class="media-heading"><a href=${url_link} display:block>${first_name} ${last_name} </a></h4>
                                    <p class="small">
                                        ${profession} <br>
                                    </p>
                                </div>
                            </div>
                        </div>
                       `;
            $('#collaborators_youneed').append($(body));
        }
      }
    });

    socket.on('three collaborators with profession you need', function(docs){
      if (docs){
        for(var i=0; i < docs.length; i++){
            var uid = docs[i].uid;
            var first_name = docs[i].first_name;
            var last_name = docs[i].last_name;
            var profession = docs[i].profession1;
            var url_link = "{% url 'week1:get_profile' user.uid %}".replace("{{user.uid}}", uid);
            var n  = users.indexOf(uid);

            var body = `
                        <div class="well well-sm personEntity">
                            <div class="media">
                                <a class="thumbnail pull-left" href="#">
                    <img class="media-object" width="100" src="{{media_url}}userphoto/${uid}.png" onerror="this.onerror=null;this.src='{% static 'images/profileimage.png' %}';">
                                </a>
                                <div class="media-body">
                                    <h4 class="media-heading"><a href=${url_link} display:block>${first_name} ${last_name} </a></h4>
                                    <p class="small">
                                        ${profession} <br>
                                    </p>
                                </div>
                            </div>
                        </div>
                       `;
            $('#collaborators_youneed').append($(body));
        }
      }
    });

    socket.on('three collaborators need you', function(docs){
      if (docs) {
        for(var i=0; i < docs.length; i++){
            var uid = docs[i].uid;
            var first_name = docs[i].first_name;
            var last_name = docs[i].last_name;
            var profession = docs[i].profession1;
            var url_link = "{% url 'week1:get_profile' user.uid %}".replace("{{user.uid}}", uid);
            var n  = users.indexOf(uid);

            var body = `
                        <div class="well well-sm personEntity">
                            <div class="media">
                                <a class="thumbnail pull-left" href="#">
				    <img class="media-object" width="100" src="{{media_url}}userphoto/${uid}.png" onerror="this.onerror=null;this.src='{% static 'images/profileimage.png' %}';">
                                </a>
                                <div class="media-body">
                                    <h4 class="media-heading"><a href=${url_link} display:block>${first_name} ${last_name} </a></h4>
                                    <p class="small">
                                        ${profession} <br>
                                    </p>
                                </div>
                            </div>
                        </div>
                       `;
            $('#collaborators_needyou').append($(body));
        }
      }
    });

    socket.on('three collaborators with profession need you', function(docs){
      if (docs) {
        for(var i=0; i < docs.length; i++){
            var uid = docs[i].uid;
            var first_name = docs[i].first_name;
            var last_name = docs[i].last_name;
            var profession = docs[i].profession1;
            var url_link = "{% url 'week1:get_profile' user.uid %}".replace("{{user.uid}}", uid);
            var n  = users.indexOf(uid);

            var body = `
                        <div class="well well-sm personEntity">
                            <div class="media">
                                <a class="thumbnail pull-left" href="#">
                    <img class="media-object" width="100" src="{{media_url}}userphoto/${uid}.png" onerror="this.onerror=null;this.src='{% static 'images/profileimage.png' %}';">
                                </a>
                                <div class="media-body">
                                    <h4 class="media-heading"><a href=${url_link} display:block>${first_name} ${last_name} </a></h4>
                                    <p class="small">
                                        ${profession} <br>
                                    </p>
                                </div>
                            </div>
                        </div>
                       `;
            $('#collaborators_needyou').append($(body));
        }
      }
    });

    function collaborateFunction(uid, c_id){
       console.log('uid on like:'+uid+':'+c_id);
        //popCollaborate();
       socket.emit('give collaborate', {to_uid:uid, uid:"{{user.uid}}", c_id:c_id, c_type:1});
       $('#qnimate').addClass('popup-box-on');
       var index = users.indexOf(uid);
       document.getElementById('status_message').value = 'Hello I\'m interested in Collaborating.';
       var elements = document.getElementsByClassName('popup-head-left pull-left');
       elements[0].innerHTML = names[index][0]+'&nbsp'+names[index][1];
       socket.emit('get message', {to_uid:uid})

       var elems = document.getElementsByClassName('btn-footer');
       elems[0].innerHTML = '<button class="btn btn-primary btn-lg pull-right" onclick="sendMessage(\''+uid+'\')">Send </button>';
    }

    function sendMessage(uid){
        console.log('send message');
        var post_val = $('#status_message').val();
                    
        if (post_val.length != 0){
            socket.emit('send message', {msg:post_val, to_uid:uid, uid:{{user.id}} });
        }
        $('#status_message').val('');
        return false;
    }

    function closeChat(){
        $('#qnimate').removeClass('popup-box-on');
    }

</script>
                                                                                                                            
</body>
</html>